<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>BCTA 평가 페이지</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="chat-box">
    <h2>📝 BCTA 평가 진행</h2>
    <div id="chatArea"></div>

    <div id="inputBox">
      <input type="text" id="userInput" placeholder="여기에 답변을 입력하세요">
      <button id="submitBtn">제출</button>
    </div>
  </div>

  <script>
  const questions = JSON.parse(localStorage.getItem("bcta_questions") || "[]");
  let current = 0;
  const answers = [];

  const chatArea = document.getElementById("chatArea");
  const userInput = document.getElementById("userInput");
  const submitBtn = document.getElementById("submitBtn");

  function showQuestion(index) {
    const q = questions[index];
    if (!q) {
      chatArea.innerHTML += `<div class="message"><div class="question">✅ 모든 질문에 답변하셨습니다. 감사합니다!</div></div>`;
      document.getElementById("inputBox").style.display = "none";
      console.log("🧠 최종 답변 결과:", answers);
      return;
    }

    const tagHTML = `
      <div class="tags">
        <span><strong>주제:</strong> ${q.tags.주제}</span> |
        <span><strong>사고기능:</strong> ${q.tags.사고기능}</span> |
        <span><strong>정서:</strong> ${q.tags.정서}</span>
      </div>`;

    const questionHTML = `
      <div class="message">
        <div class="question">
          <strong>질문 ${index + 1}</strong><br>
          ${q.question}
          ${tagHTML}
        </div>
      </div>`;

    chatArea.innerHTML += questionHTML;
    userInput.value = "";
    userInput.focus();
    chatArea.scrollTop = chatArea.scrollHeight;
  }

  submitBtn.onclick = () => {
    const answer = userInput.value.trim();
    if (answer === "") return;

    answers.push({
      question: questions[current].question,
      type: questions[current].type,
      tags: questions[current].tags,
      answer: answer
    });

    const answerHTML = `
      <div class="message">
        <div class="answer">${answer}</div>
      </div>`;
    chatArea.innerHTML += answerHTML;
    current++;
    showQuestion(current);
  };

  window.onload = () => {
    showQuestion(current);
  };
</script>
</body>
</html>
