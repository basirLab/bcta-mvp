<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>BCTA í‰ê°€ í˜ì´ì§€</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="chat-box">
    <h2>ğŸ“ BCTA í‰ê°€ ì§„í–‰</h2>
    <div id="chatArea"></div>

    <div id="inputBox">
      <input type="text" id="userInput" placeholder="ì—¬ê¸°ì— ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”">
      <button id="submitBtn">ì œì¶œ</button>
    </div>
  </div>

<script>
const questions = JSON.parse(localStorage.getItem("bcta_questions") || "[]");
let current = 0;
const answers = [];

const chatArea = document.getElementById("chatArea");
const userInput = document.getElementById("userInput");
const submitBtn = document.getElementById("submitBtn");

function showQuestion(index) {
  const q = questions[index];
  if (!q) {
    chatArea.innerHTML += `<div class="message"><div class="question">âœ… ëª¨ë“  ì§ˆë¬¸ì— ë‹µë³€í•˜ì…¨ìŠµë‹ˆë‹¤. GPT í‰ê°€ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤...</div></div>`;
    document.getElementById("inputBox").style.display = "none";
    evaluateWithGPT();  // ğŸ‘‰ í‰ê°€ ìš”ì²­ í•¨ìˆ˜ í˜¸ì¶œ
    return;
  }

  const tagHTML = `
    <div class="tags">
      <span><strong>ì£¼ì œ:</strong> ${q.tags.ì£¼ì œ}</span> |
      <span><strong>ì‚¬ê³ ê¸°ëŠ¥:</strong> ${q.tags.ì‚¬ê³ ê¸°ëŠ¥}</span> |
      <span><strong>ì •ì„œ:</strong> ${q.tags.ì •ì„œ}</span>
    </div>`;

  const questionHTML = `
    <div class="message">
      <div class="question">
        <strong>ì§ˆë¬¸ ${index + 1}</strong><br>
        ${q.question}
        ${tagHTML}
      </div>
    </div>`;

  chatArea.innerHTML += questionHTML;
  userInput.value = "";
  userInput.focus();
  chatArea.scrollTop = chatArea.scrollHeight;
}

submitBtn.onclick = () => {
  const answer = userInput.value.trim();
  if (answer === "") return;

  answers.push({
    question: questions[current].question,
    type: questions[current].type,
    tags: questions[current].tags,
    answer: answer
  });

  const answerHTML = `
    <div class="message">
      <div class="answer">${answer}</div>
    </div>`;
  chatArea.innerHTML += answerHTML;
  current++;
  showQuestion(current);
};

window.onload = () => {
  showQuestion(current);
};

// ğŸ‘‰ í‰ê°€ ìš”ì²­ í•¨ìˆ˜
async function evaluateWithGPT() {
  const prompt = `
ë‹¹ì‹ ì€ GPT í‰ê°€ìì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ì§ˆë¬¸-ë‹µë³€ ëª©ë¡ê³¼ ê° í•­ëª©ì˜ íƒœê·¸(ì£¼ì œ/ì‚¬ê³ ê¸°ëŠ¥/ì •ì„œ)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í‰ê°€ ê¸°ì¤€ì— ë”°ë¼ ì ìˆ˜ë¥¼ ë¶€ì—¬í•˜ì‹­ì‹œì˜¤.

ê° í•­ëª©ì— ëŒ€í•´ ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì¡°ë¡œ JSONìœ¼ë¡œ ì‘ë‹µí•˜ì‹­ì‹œì˜¤:
[
  {
    "ì§ˆë¬¸": "ì§ˆë¬¸ ë‚´ìš©",
    "ë‹µë³€": "ì‚¬ìš©ì ë‹µë³€",
    "ì‚¬ê³ ê¸°ëŠ¥": "ë¶„ì„",  // ì˜ˆì‹œ
    "ì ìˆ˜": 4.5,
    "ì´ìœ ": "í•µì‹¬ ë…¼ë¦¬ë¥¼ ì˜ ì„¤ëª…í•˜ì˜€ìŒ"
  },
  ...
]
ì§ˆë¬¸-ë‹µë³€ ëª©ë¡:
${answers.map((item, i) => `Q${i + 1}: ${item.question}\nA${i + 1}: ${item.answer}\n[ì‚¬ê³ ê¸°ëŠ¥: ${item.tags.ì‚¬ê³ ê¸°ëŠ¥}]`).join('\n\n')}
`;

  try {
    const res = await fetch("/api/openai", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ prompt })
    });

    const data = await res.json();
    localStorage.setItem("bcta_result", data.result);
    window.location.href = "result.html";
  } catch (err) {
    alert("GPT í‰ê°€ ìš”ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
    console.error(err);
  }
}
</script>
</body>
</html>
ã„´
